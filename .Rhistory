summarise_at(vars(male:elderly), ~ sum(.))
fsc %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE))
fsc %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4954060,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
group_by(so) %>%
summarise_at(vars(male:elderly), ~ sum(.))
fsc %>%
group_by(so) %>%
summarise(new_beneficiaries = sum(new_beneficiaries),
reached_beneficiaries = sum(reached_beneficiaries))
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(pander)
library(janitor)
library(fuzzyjoin)
library(scales)
library(magrittr)
library(sf)
library(kableExtra)
library(viridis)
library(skimr)
theme_set(theme_light())
# disabling scientific notation
options(scipen = 100)
# pander tables all in one row
panderOptions('table.split.table', Inf)
# pander thousands separator
panderOptions("big.mark", ",")
# replace
opts <- options(knitr.kable.NA = "")
`%out%` <- Negate(`%in%`)
# function for transposing df
transpose_df <- function(df) {
t_df <- data.table::transpose(df)
colnames(t_df) <- rownames(df)
rownames(t_df) <- colnames(df)
t_df <- t_df %>%
tibble::rownames_to_column(.data = .) %>%
tibble::as_tibble(.)
return(t_df)
}
# function beneficiary summaries
sum_ben <- function(df, column_var){
column_var <- enquo(column_var)
df %>%
group_by(!!column_var) %>% # must add bang-bang
summarise(beneficiaries = sum(beneficiaries)) %>%
arrange(desc(beneficiaries))
}
# function beneficiary summaries, 2 grouped variables
sum_ben2 <- function(df, column_var1, column_var2){
column_var1 <- enquo(column_var1)
column_var2 <- enquo(column_var2)
df %>%
group_by(!!column_var1, !!column_var2) %>% # must add bang-bang
summarise(beneficiaries = sum(beneficiaries)) %>%
arrange(desc(beneficiaries))
}
# scaling functions
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
#mode function
mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
codes <- read_csv("Myanmar humanitarian partner list.csv") %>% clean_names()
pcode4 <- read_excel("2022_FSCMYA_5W_template_Q1 2022_IM Combined_25042022.xlsx",
sheet = "GEOADMINS") %>%
clean_names() %>%
select(admin1pcode_9:admin1_3) %>%
rename(admin1_pcode = admin1pcode_9,
state = state_10,
township = township_11,
admin3_pcode = admin3pcode_12,
vt_town = vt_and_town_13,
admin4_pcode = vt_and_town_pcode_14)
villages <- read_excel("2022_FSCMYA_5W_template_Q1 2022_IM Combined_25042022.xlsx",
sheet = "GEOADMINS") %>%
clean_names() %>%
select(admin1pcode_17:location_type) %>%
rename(admin1_pcode = admin1pcode_17,
state = state_18,
township = township_19,
admin3_pcode = admin3pcode_20,
vt_town = vt_and_town_21,
admin4_pcode = vt_and_town_pcode_22)
camps <- read_excel("2022_FSCMYA_5W_template_Q1 2022_IM Combined_25042022.xlsx",
sheet = "GEOADMINS") %>%
clean_names() %>%
select(township = township_29, camp_name, pcode_camp = p_code_camp)
industrial_zones <- read_excel("2022_FSCMYA_5W_template_Q1 2022_IM Combined_25042022.xlsx",
sheet = "GEOADMINS") %>%
clean_names() %>%
select(state = state_36, admin1_pcode = admin1pcode_37, industrial_zone = industrial_zones)
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode))
fsc %>% summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>% summarise(new_beneficiaries = sum(new_beneficiaries, na.rm = TRUE))
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% distinct(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value))
fsc %>% summarise(new_beneficiaries = sum(new_beneficiaries, na.rm = TRUE))
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity)
fsc %>% summarise(new_beneficiaries = sum(new_beneficiaries, na.rm = TRUE))
2233533	- 2230628
fsc2 <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% distinct(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value))
fsc2 %>%  filter(new_beneficiaries == 2905)
fsc2 %>% filter(admin4_pcode == "MMR007008058")
fsc <- read_csv("fsc_codes.csv") %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% select(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value)) %>%
rename(state = state_region) %>%
mutate(admin3_pcode_old = case_when(admin3_pcode %in% c("MMR013046", "MMR013047") ~ "MMR013008",
admin3_pcode == "MMR015202" ~ "MMR015022",
admin3_pcode == "MMR015315" ~ "MMR015010",
admin3_pcode == "MMR015312" ~ "MMR015006",
admin3_pcode == "MMR015308" ~ "MMR015007",
admin3_pcode == "MMR016321" ~ "MMR016003",
TRUE ~ admin3_pcode)) %>%
replace_na(list(new_beneficiaries = 0)) %>%
mutate(activity_red = case_when(activity %in% c("food distributions (in kind/voucher/cash), moderate",
"food distributions (in kind/voucher/cash), severe") ~
"food distribution",
activity %in% c("multi-purpose cash transfer (MPC), moderate",
"multi-purpose cash transfer (MPC), severe") ~
"multi-purpose cash transfer",
TRUE ~ activity)) %>%
mutate(so = case_when(activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type == "Internally Displaced" ~
"so_1",
activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type != "Internally Displaced" ~
"so_2",
TRUE ~ "so_3")) %>%
filter(admin4_pcode != "MMR007008058")
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% select(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value)) %>%
rename(state = state_region) %>%
mutate(admin3_pcode_old = case_when(admin3_pcode %in% c("MMR013046", "MMR013047") ~ "MMR013008",
admin3_pcode == "MMR015202" ~ "MMR015022",
admin3_pcode == "MMR015315" ~ "MMR015010",
admin3_pcode == "MMR015312" ~ "MMR015006",
admin3_pcode == "MMR015308" ~ "MMR015007",
admin3_pcode == "MMR016321" ~ "MMR016003",
TRUE ~ admin3_pcode)) %>%
replace_na(list(new_beneficiaries = 0)) %>%
mutate(activity_red = case_when(activity %in% c("food distributions (in kind/voucher/cash), moderate",
"food distributions (in kind/voucher/cash), severe") ~
"food distribution",
activity %in% c("multi-purpose cash transfer (MPC), moderate",
"multi-purpose cash transfer (MPC), severe") ~
"multi-purpose cash transfer",
TRUE ~ activity)) %>%
mutate(so = case_when(activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type == "Internally Displaced" ~
"so_1",
activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type != "Internally Displaced" ~
"so_2",
TRUE ~ "so_3")) %>%
filter(admin4_pcode != "MMR007008058")
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% select(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
filter(admin4_pcode != "MMR007008058") %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value)) %>%
rename(state = state_region) %>%
mutate(admin3_pcode_old = case_when(admin3_pcode %in% c("MMR013046", "MMR013047") ~ "MMR013008",
admin3_pcode == "MMR015202" ~ "MMR015022",
admin3_pcode == "MMR015315" ~ "MMR015010",
admin3_pcode == "MMR015312" ~ "MMR015006",
admin3_pcode == "MMR015308" ~ "MMR015007",
admin3_pcode == "MMR016321" ~ "MMR016003",
TRUE ~ admin3_pcode)) %>%
replace_na(list(new_beneficiaries = 0)) %>%
mutate(activity_red = case_when(activity %in% c("food distributions (in kind/voucher/cash), moderate",
"food distributions (in kind/voucher/cash), severe") ~
"food distribution",
activity %in% c("multi-purpose cash transfer (MPC), moderate",
"multi-purpose cash transfer (MPC), severe") ~
"multi-purpose cash transfer",
TRUE ~ activity)) %>%
mutate(so = case_when(activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type == "Internally Displaced" ~
"so_1",
activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type != "Internally Displaced" ~
"so_2",
TRUE ~ "so_3"))
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
left_join(pcode4 %>% select(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by =
c("village_tract_town" = "vt_town", "township" = "township",
"admin3_pcode" = "admin3_pcode", "admin1_pcode" = "admin1_pcode")) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value)) %>%
rename(state = state_region) %>%
mutate(admin3_pcode_old = case_when(admin3_pcode %in% c("MMR013046", "MMR013047") ~ "MMR013008",
admin3_pcode == "MMR015202" ~ "MMR015022",
admin3_pcode == "MMR015315" ~ "MMR015010",
admin3_pcode == "MMR015312" ~ "MMR015006",
admin3_pcode == "MMR015308" ~ "MMR015007",
admin3_pcode == "MMR016321" ~ "MMR016003",
TRUE ~ admin3_pcode)) %>%
replace_na(list(new_beneficiaries = 0)) %>%
mutate(activity_red = case_when(activity %in% c("food distributions (in kind/voucher/cash), moderate",
"food distributions (in kind/voucher/cash), severe") ~
"food distribution",
activity %in% c("multi-purpose cash transfer (MPC), moderate",
"multi-purpose cash transfer (MPC), severe") ~
"multi-purpose cash transfer",
TRUE ~ activity)) %>%
mutate(so = case_when(activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type == "Internally Displaced" ~
"so_1",
activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type != "Internally Displaced" ~
"so_2",
TRUE ~ "so_3"))
fsc %>%  summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%
filter(admin4_pcode != "MMR007008058") %>%
summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%
filter(admin4_pcode == "MMR007008058") %>%
summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%
# filter(admin4_pcode == "MMR007008058") %>%
summarise(new_beneficiaries = sum(new_beneficiaries))
2233533	- 2905
fsc %>%
filter(admin4_pcode == "MMR007008058")
fsc %>%
filter(admin4_pcode != "MMR007008058" & location != "Du Yin Pin") %>%
summarise(new_beneficiaries = sum(new_beneficiaries))
fsc %>%
filter(admin4_pcode != "MMR007008058")>%
fsc %>%
filter(admin4_pcode != "MMR007008058") %>%
summarise(new_beneficiaries = sum(new_beneficiaries))
1971616	- 2230628
fsc2 <- read_excel("C:/Users/seany/Downloads/R/not_for_sharing/2022_FSCMYA_5W_template_Q1 2022_IM Combined_draft_27042022_.xlsx",
sheet = "FSC 5W Activities", skip = 4) %>%
clean_names() %>%
filter(!is.na(month_of_implementation)) %>%
rename_all(~str_replace_all(., "^number_of_", "")) %>%
rename_all(~str_replace_all(., "^number_", "")) %>%
rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>%
mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>%
mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,
!is.na(village_ward) ~ village_ward,
!is.na(specify_location) ~ specify_location,
!is.na(village_tract_town) ~ village_tract_town)) %>%
mutate(date = my(month_of_implementation)) %>%
rename(activity = fsc_main_activity) %>%
mutate(township = recode(township, "Putao" = "Puta-O"),
admin3_pcode = ifelse(township == "Puta-O", "MMR001014", admin3_pcode)) %>%
mutate(total_value_usd = case_when(currency == "MMK" ~ total_value / 1776,
currency == "USD" ~ total_value)) %>%
rename(state = state_region) %>%
mutate(admin3_pcode_old = case_when(admin3_pcode %in% c("MMR013046", "MMR013047") ~ "MMR013008",
admin3_pcode == "MMR015202" ~ "MMR015022",
admin3_pcode == "MMR015315" ~ "MMR015010",
admin3_pcode == "MMR015312" ~ "MMR015006",
admin3_pcode == "MMR015308" ~ "MMR015007",
admin3_pcode == "MMR016321" ~ "MMR016003",
TRUE ~ admin3_pcode)) %>%
replace_na(list(new_beneficiaries = 0)) %>%
mutate(activity_red = case_when(activity %in% c("food distributions (in kind/voucher/cash), moderate",
"food distributions (in kind/voucher/cash), severe") ~
"food distribution",
activity %in% c("multi-purpose cash transfer (MPC), moderate",
"multi-purpose cash transfer (MPC), severe") ~
"multi-purpose cash transfer",
TRUE ~ activity)) %>%
mutate(so = case_when(activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type == "Internally Displaced" ~
"so_1",
activity_red %in% c("food distribution", "multi-purpose cash transfer") &
beneficiary_type != "Internally Displaced" ~
"so_2",
TRUE ~ "so_3"))
fsc2 %>%
group_by(so) %>%
summarise(new_beneficiaries = sum(new_beneficiaries),
reached_beneficiaries = sum(reached_beneficiaries)) %>%
mutate(pc = new_beneficiaries / reached_beneficiaries)
fsc2 %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4931810,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
group_by(so) %>%
summarise_at(vars(male:elderly), ~ sum(.))
fsc2 %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4931810,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
# group_by(so) %>%
summarise_at(vars(male:elderly), ~ sum(.))
fsc2 %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4931810,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
# group_by(so) %>%
summarise_at(vars(male:elderly), ~ sum(.))
fsc2 %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4931810,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
# group_by(so) %>%
ungroup() %>%
summarise_at(vars(male:elderly), ~ sum(.))
fsc2 %>%
group_by(so, state) %>%
summarise_at(vars(child_male:elderly_female), ~ sum(., na.rm = TRUE)) %>%
mutate(male = child_male + adult_male + elderly_male,
female = child_female + adult_female + elderly_female,
children = child_male + child_female,
adults = adult_male + adult_female,
elderly = elderly_male + elderly_female) %>%
select(-c(child_male:elderly_female)) %>%
mutate_at(vars(male:elderly), ~ case_when(so == "so_1" ~ . * 0.4931810,
so == "so_2" ~ . * 0.8458814,
so == "so_3" ~ . * 0.9686332)) %>%
group_by(so) %>%
# ungroup() %>%
summarise_at(vars(male:elderly), ~ sum(.))
