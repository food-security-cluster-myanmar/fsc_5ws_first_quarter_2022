"0","tsp_ord <- fsc %>%"
"0","  group_by(township) %>% "
"0","  summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE)) %>% "
"0","  mutate(township = case_when(beneficiaries <= 30215 ~ ""55 other townships"", "
"0","                              TRUE ~ township)) %>% "
"0","  group_by(township) %>% "
"0","  summarise_all(.funs = sum) %>% arrange(desc(beneficiaries))"
"0",""
"0","fsc %>%  "
"0","  group_by(state, township, humanitarian_or_development) %>% "
"0","  summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE), .groups = ""drop"") %>% "
"0","  mutate(humanitarian_or_development = str_to_lower(humanitarian_or_development)) %>%"
"0","  pivot_wider(names_from = humanitarian_or_development, values_from = beneficiaries) %>% "
"0","  rowwise() %>% "
"0","  mutate(beneficiaries = sum(development, humanitarian, na.rm = TRUE)) %>% "
"0","  mutate(township = case_when(beneficiaries <= 30215 ~ ""55 other townships"", "
"0","                              TRUE ~ township), "
"0","         state = case_when(beneficiaries <= 30215 ~ NA_character_, "
"0","                              TRUE ~ state)) %>% "
"0","  group_by(state, township) %>% "
"0","  summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),"
"0","            humanitarian = sum(humanitarian, na.rm = TRUE),"
"0","            development = sum(development, na.rm = TRUE), .groups = ""drop"") %>% "
"0","  mutate(pct_of_total = round(beneficiaries / sum(beneficiaries) * 100, digits = 2)) %>% "
"0","  arrange(desc(pct_of_total)) %>% "
"0","  select(State = state, Township = township, Humanitarian = humanitarian, Development = development,"
"0","         Beneficiaries = beneficiaries, `%_Total` = pct_of_total) %>% "
"0","  kbl(caption = ""Top 7 townships by beneficiaries reached (desc)"", format.args = list(big.mark = "","")) %>% "
"0","  column_spec(6, color = ""white"", background = spec_color(tsp_ord$beneficiaries[1:8], end = 0.8, direction = -1)) %>%"
"0","  kable_classic_2(lightable_options = c(""striped"")) %>% "
"0","  footnote(""The 55 other townships are each less than 1.5% of the total"", "
"0","           general_title = """")"
